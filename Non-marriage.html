<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد تعهد بعدم زواج</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            color: #333;
            animation: fadeInAnimation 0.8s ease-in-out;
        }

        /* --- Page Transition Animations --- */
        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOutAnimation {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(10px); }
        }
        .fade-out {
            animation: fadeOutAnimation 0.6s ease-in-out forwards;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            border-radius: 12px;
            border: 1px solid rgba(209, 213, 219, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.17);
        }
        .form-input, .form-select {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(209, 213, 219, 0.5);
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus {
            background-color: rgba(255, 255, 255, 1);
            border-color: #60a5fa; /* Tailwind blue-400 */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(59, 130, 246, 0.4);
        }
        .btn-secondary {
            background-color: #9ca3af; /* Tailwind gray-400 */
            color: white;
             transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #6b7280; /* Tailwind gray-500 */
            transform: translateY(-1px);
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            margin-bottom: 1.5rem;
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(209, 213, 219, 0.4);
            border-radius: 8px;
            color: #374151; /* gray-700 */
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            backdrop-filter: blur(5px);
        }
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .back-button-arrow {
            margin-left: 0.5rem;
            font-weight: bold;
            transition: transform 0.2s ease-in-out;
        }
        .back-button:hover .back-button-arrow { transform: translateX(3px); }

        .unified-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(209, 213, 219, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            color: #4b5563;
            text-decoration: none;
            transition: color 0.4s ease, text-shadow 0.4s ease;
        }
        .github-link:hover {
            color: #3b82f6;
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
        }
        .github-link svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
            transition: transform 0.4s ease;
        }
        .github-link:hover svg {
            transform: scale(1.1);
        }

        #letterPreviewContainer { display: none; margin-top: 2rem; padding: 2rem; }
        #letterOutput {
            background-color: white; width: 210mm; min-height: 297mm;
            padding: 15mm 15mm; margin: 0 auto; box-shadow: 0 0 15px rgba(0,0,0,0.2);
            color: black; font-size: 12pt; line-height: 1.8; position: relative;
            display: flex; flex-direction: column;
        }
        #letterOutput p { text-align: right; }
        .letterhead { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; min-height: 100px; }
        .letterhead-logo { max-height: 91px; max-width: 182px; object-fit: contain; }
        .gdrfa-logo-specific { max-height: 133px; max-width: 264px; object-fit: contain; }
        .letterhead .logo-container { display: flex; align-items: center; }
        #letterOutput .date-line { text-align: right; font-size: 11pt; font-weight: bold; margin-bottom: 1rem; }
        #letterOutput .subject-line { font-weight: bold; text-align: center; margin-top: 0.5rem; margin-bottom: 1.5rem; font-size: 16pt; text-decoration: underline; color: red; }
        #letterOutput .salutation { text-align: right; font-size: 12pt; font-weight: bold; margin-bottom: 0.75rem; line-height: 1.6; }
        #letterOutput .main-content { flex-grow: 1; }
        #letterOutput .main-content p { margin-bottom: 1.2rem; line-height: 1.7; }
        #letterOutput .legal-clause { font-size: 12pt; line-height: 1.6; text-align: justify; margin-top: 1.5rem; padding: 0.5rem; border: 1px solid #eee; border-radius: 4px; }
        #letterOutput .closing-statement { margin-top: 2rem; margin-bottom: 1rem; font-weight: bold; }
        #letterOutput .new-signature-area { margin-top: 1rem; text-align: right; padding-bottom: 2rem; }
        #letterOutput .new-signature-area p { font-size: 12pt; margin-bottom: 0.5rem; }
        .hidden { display: none; }

        /* --- Print Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-image {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        /* --- Pulsing Glow Animation --- */
        @keyframes pulse-glow {
            0%, 100% {
                color: #3b82f6;
                text-shadow: 0 0 4px rgba(96, 165, 250, 0.4);
            }
            50% {
                color: #60a5fa;
                text-shadow: 0 0 12px rgba(96, 165, 250, 0.8);
            }
        }
        .pulsing-glow {
            font-weight: 700;
            animation: pulse-glow 2.5s infinite ease-in-out;
        }


        @media print {
            body { background: none; font-family: 'Tajawal', sans-serif; }
            .no-print { display: none !important; }
            #letterPreviewContainer { display: block !important; margin: 0; padding: 0; }
            #letterOutput { width: 100%; min-height: 277mm; height: auto; margin: 0; box-shadow: none; border: none; padding: 10mm 10mm; font-size: 12pt; line-height: 1.7; }
            .letterhead { min-height: 90px; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
    
    <div class="w-full max-w-4xl no-print">
        <a href="index.html" class="back-button page-link">
            <span class="back-button-arrow">&rarr;</span>
            العودة إلى الرئيسية
        </a>
    </div>

    <div class="w-full max-w-4xl p-6 sm:p-8 glass-effect no-print">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-700 mb-8">
            إنشاء تعهد بعدم زواج
        </h1>

        <form id="nocForm" class="space-y-6">
            <h2 class="text-xl font-semibold text-gray-700 pt-4 border-t border-gray-300 mt-6">
                تفاصيل مُقدم التعهد
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="declarantName" class="block text-sm font-medium text-gray-700 mb-1">اسم مُقدم التعهد كاملاً:</label>
                    <input type="text" id="declarantName" name="declarantName" class="form-input w-full rounded-md p-2.5" placeholder="مثال: محمد عبدالله الأحمد" required>
                </div>
                <div>
                    <label for="declarantRelationship" class="block text-sm font-medium text-gray-700 mb-1">صلة القرابة بصاحب/ة الشأن:</label>
                    <select id="declarantRelationship" name="declarantRelationship" class="form-select w-full rounded-md p-2.5" required>
                        <option value="ابنتي">ابنتي</option>
                        <option value="أختي">أختي</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                 <div id="otherRelationshipContainer" class="hidden">
                    <label for="otherRelationship" class="block text-sm font-medium text-gray-700 mb-1">يرجى تحديد صلة القرابة الأخرى:</label>
                    <input type="text" id="otherRelationship" name="otherRelationship" class="form-input w-full rounded-md p-2.5" placeholder="مثال: ابنة أخي، قريب من الدرجة الثانية">
                </div>
                <div id="otherGenderContainer" class="hidden">
                    <label for="otherGender" class="block text-sm font-medium text-gray-700 mb-1">تحديد الجنس:</label>
                    <select id="otherGender" name="otherGender" class="form-select w-full rounded-md p-2.5">
                        <option value="الآنسة">الآنسة</option>
                        <option value="السيد">السيد</option>
                    </select>
                </div>
                <div>
                    <label for="declarantNationality" class="block text-sm font-medium text-gray-700 mb-1">جنسية مُقدم التعهد:</label>
                    <input type="text" id="declarantNationality" name="declarantNationality" class="form-input w-full rounded-md p-2.5" placeholder="مثال: الإماراتية" required>
                </div>
                <div>
                    <label for="declarantIdNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم هوية مُقدم التعهد/الرقم الموحد:</label>
                    <input type="text" id="declarantIdNumber" name="declarantIdNumber" class="form-input w-full rounded-md p-2.5" placeholder="رقم الهوية أو الرقم الموحد" required>
                </div>
            </div>

            <h2 class="text-xl font-semibold text-gray-700 pt-4 border-t border-gray-300 mt-6">
                تفاصيل صاحب/ة الشأن
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="concernedPersonName" class="block text-sm font-medium text-gray-700 mb-1">اسم صاحب/ة الشأن كاملاً:</label>
                    <input type="text" id="concernedPersonName" name="concernedPersonName" class="form-input w-full rounded-md p-2.5" placeholder="مثال: فاطمة محمد الأحمد" required>
                </div>
                <div>
                    <label for="concernedPersonNationality" class="block text-sm font-medium text-gray-700 mb-1">جنسية صاحب/ة الشأن:</label>
                    <input type="text" id="concernedPersonNationality" name="concernedPersonNationality" class="form-input w-full rounded-md p-2.5" placeholder="مثال: الإماراتية" required>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 pt-6">
                <button type="submit" class="btn-primary text-white font-semibold py-2.5 px-6 rounded-lg w-full sm:w-auto">
                    إنشاء التعهد
                </button>
                <button type="button" id="printLetterButton" class="btn-secondary font-semibold py-2.5 px-6 rounded-lg w-full sm:w-auto hidden">
                    طباعة التعهد
                </button>
            </div>

        </form>

        <footer class="unified-footer">
            <p>تم إنشاؤه بواسطة</p>
            <a href="https://github.com/mo-omen/" target="_blank" rel="noopener noreferrer" class="github-link">
                <svg viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                <span>مؤمن الحاج</span>
            </a>
        </footer>
    </div>

    <div id="letterPreviewContainer" class="w-full glass-effect mt-8">
        <div id="letterOutput" dir="rtl"></div>
    </div>

    <!-- Print Modal HTML -->
    <div id="printModal" class="modal-overlay no-print">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-gray-800">إرشادات الطباعة</h2>
            <p class="text-gray-600 mt-2">للحصول على أفضل نتيجة، يرجى تعيين خيار الهوامش <span class="pulsing-glow">Margins</span> إلى بدون <span class="pulsing-glow">None</span> في إعدادات الطباعة كما هو موضح.</p>
            <img src="src/print-setting.jpg" alt="Print Settings Guide" class="modal-image" onerror="this.alt='Please set margins to None in print settings.'; this.style.display='none';">
            <div class="modal-buttons">
                <button type="button" id="closeModalButton" class="btn-secondary font-semibold py-2 px-5 rounded-lg">إغلاق</button>
                <button type="button" id="proceedToPrintButton" class="btn-primary text-white font-semibold py-2 px-5 rounded-lg">متابعة للطباعة</button>
            </div>
        </div>
    </div>


    <script>
        // Function to get the current date in DD/MM/YYYY format
        function getCurrentArabicDate() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Getting form and output elements from the DOM
        const nocForm = document.getElementById('nocForm');
        const letterOutputDiv = document.getElementById('letterOutput');
        const letterPreviewContainer = document.getElementById('letterPreviewContainer');
        const printLetterButton = document.getElementById('printLetterButton');
        const declarantRelationshipSelect = document.getElementById('declarantRelationship');
        const otherRelationshipContainer = document.getElementById('otherRelationshipContainer');
        const otherRelationshipInput = document.getElementById('otherRelationship');
        const otherGenderContainer = document.getElementById('otherGenderContainer');
        const otherGenderSelect = document.getElementById('otherGender');

        // Modal elements
        const printModal = document.getElementById('printModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const proceedToPrintButton = document.getElementById('proceedToPrintButton');

        // Event listener to handle the visibility of "Other" relationship fields
        declarantRelationshipSelect.addEventListener('change', function() {
            if (this.value === 'أخرى') {
                // If "Other" is selected, show the text input and gender dropdown
                otherRelationshipContainer.classList.remove('hidden');
                otherGenderContainer.classList.remove('hidden');
                otherRelationshipInput.required = true;
                otherGenderSelect.required = true;
            } else {
                // Hide the fields if another option is selected
                otherRelationshipContainer.classList.add('hidden');
                otherGenderContainer.classList.add('hidden');
                otherRelationshipInput.required = false;
                otherGenderSelect.required = false;
                otherRelationshipInput.value = ''; // Clear the input
            }
        });

        // Event listener for form submission to generate the letter
        nocForm.addEventListener('submit', function(event) {
            event.preventDefault();

            // --- Gather data from form inputs ---
            const declarantName = document.getElementById('declarantName').value.trim() || "[اسم مُقدم التعهد]";
            const declarantRelationshipInput = declarantRelationshipSelect.value;
            const declarantNationality = document.getElementById('declarantNationality').value.trim() || "[جنسية مُقدم التعهد]";
            const declarantIdNumber = document.getElementById('declarantIdNumber').value.trim() || "[رقم الهوية/الرقم الموحد]";
            const concernedPersonName = document.getElementById('concernedPersonName').value.trim() || "[اسم صاحب/ة الشأن]"; 
            const concernedPersonNationality = document.getElementById('concernedPersonNationality').value.trim() || "[جنسية صاحب/ة الشأن]"; 
            const currentDate = getCurrentArabicDate();
            
            // --- Logic for determining relationship and gendered terms ---
            let relationshipTerm = ""; 
            let mentionedAdjective = "المذكورة"; // Default to feminine
            let maritalStatusAdjective = "غير متزوجة"; // Default to feminine

            if (declarantRelationshipInput === "أخرى") {
                const otherRelationshipText = otherRelationshipInput.value.trim();
                const gender = otherGenderSelect.value;
                
                if (gender === 'السيد') {
                    mentionedAdjective = "المذكور";
                    maritalStatusAdjective = "غير متزوج";
                }
                
                relationshipTerm = otherRelationshipText ? `${gender} (${otherRelationshipText})` : `${gender} (صلة قرابة أخرى)`; 
            } else {
                // For "ابنتي" or "أختي", the subject is female
                relationshipTerm = declarantRelationshipInput;
            }

            // --- Logo URLs with placeholders ---
            const gdrfaLogoUrl = 'src/gdrfa-logo.png';
            const uaeEagleLogoUrl = 'src/uae-eagle.png';

            // --- Generate the letter HTML ---
            letterOutputDiv.innerHTML = `
                <div class="letterhead">
                    <div class="logo-container">
                        <img src="${uaeEagleLogoUrl}" alt="شعار الإمارات العربية المتحدة" class="letterhead-logo" onerror="this.alt='UAE Eagle Logo Not Found'; this.src='https://placehold.co/80x80/CCCCCC/B22222?text=UAE+Eagle+Missing';">
                    </div>
                    <div class="logo-container">
                        <img src="${gdrfaLogoUrl}" alt="شعار الإدارة العامة للإقامة وشؤون الأجانب" class="gdrfa-logo-specific" onerror="this.alt='GDRFA Logo Not Found'; this.src='https://placehold.co/100x50/CCCCCC/B22222?text=GDRFA+Missing';">
                    </div>
                </div>
                <div class="date-line">التاريخ: ${currentDate}</div> 
                <div class="main-content">
                    <h2 class="subject-line">تعهد بعدم زواج</h2> 
                    <div class="salutation" style="margin-top:4.5rem;">السادة/ الهيئة الاتحادية للهوية والجنسية المحترمون</div>
                    <div class="salutation">سعادة/ المدير العام للإقامة وشؤون الأجانب - دبي المحترم</div>
                    <p style="margin-top: 2.5rem;">
                        أتعهد أنا الموقع أدناه: <strong>${declarantName}</strong>، الجنسية: <strong>${declarantNationality}</strong>.
                    </p>
                    <p>
                        رقم الملف / الرقم الموحد / رقم هوية: <strong>${declarantIdNumber}</strong>. بأن ${relationshipTerm} ${mentionedAdjective}:
                    </p>
                    <p>
                        <strong>${concernedPersonName}</strong>، الجنسية: <strong>${concernedPersonNationality}</strong>، ${maritalStatusAdjective}.
                    </p>
                    <p class="legal-clause">
                        وفي حال ثبوت غير ذلك أتحمل كافة تبعيات هذا الإقرار وذلك استناداً إلى المادة رقم (33) من قانون دخول وإقامة الأجانب 1973/6 (كل من أعطى بياناً كاذباً بقصد التهرب من أحكام هذا القانون يعاقب بالحبس مدة لا تجاوز ستة أشهر وبغرامة لا تقل عن (5000) خمسة آلاف درهم ولا تجاوز (10000) عشرة آلاف درهم أو بإحدى هاتين العقوبتين، وعلى المحكمة أن تأمر بإبعاد المخالف عن الدولة).
                    </p>
                    <p class="closing-statement">وهذا إقرار مني بذلك ، ، ،</p>
                </div>
                <div class="new-signature-area">
                    <p>التوقيع: .......................................</p>
                </div>
            `;

            // --- Show the generated letter and print button ---
            letterPreviewContainer.style.display = 'block';
            printLetterButton.classList.remove('hidden');
            letterPreviewContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // --- Modal Control Script ---
        // Event listener for the main "Print" button to open the modal
        printLetterButton.addEventListener('click', function() {
            printModal.classList.add('visible');
        });
        
        // Event listener for the "Close" button in the modal
        closeModalButton.addEventListener('click', function() {
            printModal.classList.remove('visible');
        });

        // Event listener to close the modal when clicking the overlay
        printModal.addEventListener('click', function(event) {
            if (event.target === printModal) {
                printModal.classList.remove('visible');
            }
        });

        // Event listener for the "Proceed to Print" button in the modal
        proceedToPrintButton.addEventListener('click', function() {
            printModal.classList.remove('visible');
            // A short delay to allow the modal to close before opening the print dialog
            setTimeout(() => {
                window.print();
            }, 100);
        });
        
        // --- Page Transition Script ---
        document.addEventListener('DOMContentLoaded', () => {
            const pageLinks = document.querySelectorAll('.page-link');
            pageLinks.forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const destination = link.href;
                    document.body.classList.add('fade-out');
                    setTimeout(() => {
                        window.location.href = destination;
                    }, 600); // Match this duration with the fadeOutAnimation
                });
            });
        });
    </script>
</body>
</html>
